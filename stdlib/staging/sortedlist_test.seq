import random
from sortedlist import SortedList
from itertools import chain

@test
def test_init():
    slt = SortedList[int]()
    assert slt.key is None
    slt._check()

    slt = SortedList[int]()
    slt._reset(10000)
    assert slt._load == 10000
    slt._check()

    # slt = SortedList[int](range(10000)) - changed due to lack of optional arguments
    slt = SortedList[int]()
    slt.update(list[int](range(10000)))
    assert all(tup[0] == tup[1] for tup in zip(slt, range(10000)))

    slt.clear()
    assert slt._len == 0
    assert slt._maxes == list[int]()
    assert slt._lists == list[list[int]]()
    slt._check()
test_init()

@test
def test_add():
    random.seed(0)
    slt = SortedList[int]()
    for val in range(1000):
        slt.add(val)
        slt._check()
    
    slt2 = SortedList[int]()
    for val in range(1000, 0, -1):
        slt2.add(val)
        slt2._check()

    slt3 = SortedList[float]()
    for val in range(1000):
        slt3.add(random.random())
        slt3._check()
test_add()

@test
def test_update():
    slt = SortedList[int]()

    slt.update(list[int](range(1000)))
    assert len(slt) == 1000
    slt._check()

    slt.update(list[int](range(100)))
    assert len(slt) == 1100
    slt._check()

    slt.update(list[int](range(10000)))
    assert len(slt) == 11100
    slt._check()

    values = sorted(list[int](range(1000)) + list[int](range(100)) + list[int](range(10000)))
    assert all(tup[0] == tup[1] for tup in zip(slt, values))
test_update()

@test
def test_contains():
    slt = SortedList[int]()
    assert 0 not in slt

    slt.update(list[int](range(10000)))

    for val in range(10000):
        assert val in slt

    assert 10000 not in slt

    slt._check
test_contains()

@test
def test_discard():
    slt = SortedList[int]()
    
    # assert slt.discard(0) == None - Can't compare void with none
    assert len(slt) == 0
    slt._check()

    slt.update([1, 2, 2, 2, 3, 3, 5])
    slt._reset(4)

    slt.discard(6)
    slt._check()
    slt.discard(4)
    slt._check()
    slt.discard(2)
    slt._check()

    assert all(tup[0] == tup[1] for tup in zip(slt, [1, 2, 2, 3, 3, 5]))
test_discard()

@test
def test_remove():
    slt = SortedList[int]()

    # assert slt.discard(0) == None - Can't compare void with none
    assert len(slt) == 0
    slt._check()

    slt.update([1, 2, 2, 2, 3, 3, 5])
    slt._reset(4)

    slt.remove(2)
    slt._check()

    assert all(tup[0] == tup[1] for tup in zip(slt, [1, 2, 2, 3, 3, 5]))
test_remove()

# FIXME?
"""
def test_remove_valueerror1():
    slt = SortedList()
    with pytest.raises(ValueError):
        slt.remove(0)

def test_remove_valueerror2():
    slt = SortedList(range(100))
    slt._reset(10)
    with pytest.raises(ValueError):
        slt.remove(100)

def test_remove_valueerror3():
    slt = SortedList([1, 2, 2, 2, 3, 3, 5])
    with pytest.raises(ValueError):
        slt.remove(4)
"""

@test
def test_delete():
    slt = SortedList[int]()
    slt.update(list[int](range(20)))
    slt._reset(4)
    slt._check()
    for val in range(20):
        slt.remove(val)
        slt._check()
    assert len(slt) == 0
    assert slt._maxes == list[int]()
    assert slt._lists == list[list[int]]()
test_delete()
